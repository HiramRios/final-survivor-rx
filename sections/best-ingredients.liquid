{% if product.metafields.custom.pdp_ingredients != blank %}
  <div class="wrapper">
    <div class="best-ingredients">
      <h2 class="best-ingredients__heading">
        {{ section.settings.title }}
      </h2>
      <p class="best-ingredients__content">
        {{ section.settings.content }}
      </p>

      <div class="best-ingredients__blocks tab tab-active active-a" data-id="viewall">
        {% for item in product.metafields.custom.pdp_ingredients.value %}
          <div class="best-ingredients__block">
            <img class="ingredient-block__img" src="{{ item.ingredient_image | img_url: '600x' }}">
            <span class="ingredient-block__title">{{ item.ingredient_short_name }}</span>
            <span class="ingredient-block__content">
              {% if item.known_for.value != blank %}
                Known for 
                {% for knownfor in item.known_for.value %}
                  {{ knownfor -}}
                  {%- unless forloop.last == true %},{% endunless %}
                {% endfor %}
              {% endif %}
            </span>
            <a class="ingredient-block__link cstm_ingredient_read" 
              data-id="{{ item.ingredient_short_name | handle }}"
              href="#"
              open_text_handle="{{ item.ingredient_short_name | handle }}"
              open_text="{{ item.ingredient_short_name | handle }}">Learn More</a>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="cstm_slider_wrapper cstm_new_popup" style="visibility:hidden">
    <div class="cstm-popup-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
        <path d="M25 7L7 25" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M25 25L7 7" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  
    <div class="main_tab_wrapper cstm-slider-img" style="display:none">
      {% assign counting = 0 %}
      {% for item in product.metafields.custom.pdp_ingredients.value %}
        {% if item.ingredient_short_name %}
          {% assign counting = counting | plus: 1 %}
          
          <div
            class="tab newidtab"
            data-count="{{ counting }}"
            data-id="viewall"
            open_tab_cstm="{{ item.ingredient_short_name | handle }}"
          >
            <div class="inner_wrapper_tab">
              <div class="cstm-inner-contnt">
                <!-- Content here -->
              </div>
              <img
                src="{{ item.ingredient_image | img_url: 'master' }}"
                alt="Ingredient Image"
                width="200px"
                height="200px"
              >

              <div class="center-text ingredient-heading">
                <h3>{{ item.ingredient_short_name }}</h3>
                <p style="text-align:center;">{{ item.ingredient_long_name }}</p>
              </div>

              <hr>

              <div class="csmt_info--jtpl">
                {% if item.known_for.value != blank %}
                  <p>
                   <b> Known For</b><br>
                    <span class="halfknown" data-item-id="{{ item.ingredient_short_name }}">
                      {% for knownfor in item.known_for.value %}
                        {% if forloop.index < 30 %}
                          {{ knownfor -}}
                          {%- unless forloop.last == true %},{% endunless %}
                        {% endif %}
                        {% if forloop.index == 30 %}
                          <a class="viewmore">View more</a>
                        {% endif %}
                      {% endfor %}
                    </span>
                    <span class="fullknon" style="display:none" data-item-id="{{ item.ingredient_short_name }}">
                      {% for knownfor in item.known_for.value %}
                        {{ knownfor -}}
                        {%- unless forloop.last %},{% endunless %}
                      {% endfor %}
                      <a class="lessmore">Show less</a>
                    </span>
                  </p>
                {% endif %}

                {% if item.can_be_found_in_supplements.value != blank %}
                  <p>
                                            <b>Can Be Found In</b>

                 <br>
                    <span class="halfknown2">
                      {% for foundin in item.can_be_found_in_supplements.value %}
                        {% if forloop.index < 30 %}
                          {{ foundin.heading }}{%- unless forloop.last %},{% endunless %}
                        {% endif %}
                        {% if forloop.index == 30 %}
                          <a class="viewmore2">View more</a>
                        {% endif %}
                      {% endfor %}
                    </span>
                    <span class="fullknon2" style="display:none">
                      {% for foundin in item.can_be_found_in__products.value %}
                        {{ foundin.heading -}}
                        {%- unless forloop.last %},{% endunless %}
                      {% endfor %}
                      <a class="lessmore2">Show less</a>
                    </span>
                  </p>
                {% endif %}

                <span class="cstmsurvivor--description">
                  {% if item.ingredient_description != blank %}
                    {{ item.ingredient_description | metafield_tag }}
                  {% endif %}
                </span>

                
                {% if item.ingredient_quote != blank %}

                <span class="cstmingredient--quote">
                  {% if item.ingredient_quote != blank %}
                    {{ item.ingredient_quote | metafield_tag }}
                  {% endif %}
                </span>
                                      {% endif %}


                {% if item.why_we_chose_it != blank %}
                  <p class="ingredient-size">
                   Why We Chose It {{ item.why_we_chose_it | metafield_tag }}
                  </p>
                {% endif %}

                {% if item.where_its_from != blank %}
                  <p class="ingredient-size">
                    Where It's From<span>{{ item.where_its_from | metafield_tag }}</span>
                  </p>
                {% endif %}

                {% if item.the_science != blank %}
                  <p class="ingredient-size">
                    The Science <span>{{ item.the_science | metafield_tag }}</span>
                  </p>
                {% endif %}

                {% if item.references != blank %}
                  <div class="cstm_reference--jtpl">
                    <p>
                      References {{ item.references | metafield_tag }}
                    </p>
                  </div>
                {% endif %}

                {% for text in item.blog_post_links.value %}
                  {% if text.text != blank and text.url != blank %}
                    <a href="{{ text.url }}" target="_blank">{{ text.text }}</a>
                  {% endif %}
                {% endfor %}
              </div>

              <div class="cstm_disclaimer--jtpl">
                This illustration is not the source of our ingredient and is used for illustration purposes only.
              </div>

              <div class="cstm_disclaimer--jtpl">
                These statements have not been evaluated by the Food and Drug Administration. This product is not
                intended to diagnose, treat, cure, or prevent any disease. This information and articles are
                provided for educational purposes only and are unaffiliated with SurvivorRx. Medical advice should
                always come from your health care professional.
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  
    <div class="btn-wrap">
      <button class="prev-btn  ">
        {% render 'slider-prev-arrow' %}
      </button>
      <div class="e_count"></div>
      <button class="next-btn">
        {% render 'slider-next-arrow' %}
      </button>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $('.best-ingredients__blocks').slick({
        infinite: true,
        slidesToShow: 4,
        slidesToScroll: 4,
        dots: true,
        arrows: true,
        prevArrow: `<div class="slick-prev">{% render 'slider-prev-arrow' %}</div>`,
        nextArrow: `<div class="slick-next">{% render 'slider-next-arrow' %}</div>`,
        adaptiveHeight: true,
        responsive: [
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 2
            }
          },
          {
            breakpoint: 768,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
      });
    });
  </script>
  <style>
    .best-ingredients-wrapper {
      background-color: {{ section.settings.bg_color }};
    }
  </style>
{% endif %}

{% schema %}
{
  "name": "Best Ingredients",
  "class": "best-ingredients-wrapper",
  "settings": [
    {
      "type": "textarea",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "textarea",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color"
    }
  ],
  "presets": [
    {
      "name": "Best Ingredients",
      "category": "Product"
    }
  ]
}
{% endschema %}